    <html>
        <head>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

        </head>

    <body>
            <div class="mb-3">
            <label class="form-label">Message: </label>
            <input type="String" class="form-control" id="message" >
            <label class="form-label">User Name: </label>
            <input type="String" class="form-control" id="username" >
            </div>
            <button class="btn btn-primary" onclick="sendMessage()">Submit</button>
            <button class="btn btn-primary" onclick="connect()">Connect</button>
            <div>
                <ul class="active-users" id="actives">

                </ul>
            </div>
            <div>
                <ul class="list-group" id="messages">
                        
                  </ul>
            </div>


        <script>
            let m_webSocket = undefined;
            let m_username = undefined;
    

            function connect() {
                console.log('on connect');

                const webSocket = new WebSocket("ws://localhost:8080");
                
                webSocket.onopen = (event) => {
                    if (m_webSocket) {
                        m_webSocket.close();
                        m_webSocket = undefined;

                    }

                    const username = document.getElementById("username").value;


                    const msg = {
                        type: "username",
                        senderUsername: username
                    };

                    m_username = username
                    webSocket.send(JSON.stringify(msg))
                    

                    m_webSocket = webSocket;
                    _appendMessageToList("Open connection")
                };

                
                webSocket.onmessage = (event) => {
                    console.log(event.data);
                    const data = JSON.parse(event.data);
                    const type = data.type;
                    // _appendMessageToList(`Recive: ${event.data}`);
                    if(type == 'activeusers'){
                        const active = data.active;
                        const connectedUserList = data.connectedUserList;
                        _appendMessageToListUsers(`Active Users: ${connectedUserList}`);
                        if(active){
                            _appendMessageToList(`${data.username} Logged in`);
                        }else{
                            _appendMessageToList(`${data.username} Logged out`);
                        }
                    }
                    if(type == 'message'){
                        const sender = data.senderUsername;
                        _appendMessageToList(`${sender}: ${data.message}`);
                    }
                }

                webSocket.onclose = (event) => {
                    console.log('The connection has been closed successfully.');
                    m_webSocket = undefined;
                }

                webSocket.onerror = (event) => {
                    console.log('WebSocket error: ', event);
                    m_webSocket = undefined;
                }

            }

            function sendMessage() {
                if (m_webSocket) {
                    const message = document.getElementById("message").value;
                    console.log(`message: ${message}`);


                    const msg = {
                        type: "message",
                        message: message
                    };
                    _appendMessageToList(`Send : ${message} `);
                    // _appendMessageToList('Send: ' + JSON.stringify(msg));

                    m_webSocket.send(JSON.stringify(msg))
                } else {
                    console.warn("Websocket not connected");
                }
            }

            function _appendMessageToList(message) {
                const orig = document.getElementById("messages").innerHTML
                document.getElementById("messages").innerHTML = orig + `<li class="list-group-item">${message}</li>`
            }

            function _appendMessageToListUsers(message) {
                document.getElementById("actives").innerHTML = `<li class="active-users">${message}</li>`
            }

        </script>
        </body>
    </html>